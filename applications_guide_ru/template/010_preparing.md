---
title: Подготовка к работе
sidebar: applications_guide
guide_code: ____________
permalink: ____________/010_preparing.html
toc: false
---
В этой главе мы рассмотрим, как подготовить приложение и инфраструктуру для того, чтобы можно было развернуть это приложение в Kubernetes.

Итак, последующее прохождение гайда подразумевает, что у вас:

- Установлен Kubernetes-кластер;
- На Kubernetes направлен трафик;
- Есть GitLab;
- Настроен GitLab Runner, где установлена утилита werf и с которого есть доступ к кластеру Kubernetes;
- Приложение соответствует требованиям для работы в Kubernetes.

Ниже мы максимально кратко объясним, что подразумевается под каждым из этих пунктов.

## Требования к Kubernetes-кластеру

Никаких специальных требований к кластеру не предъявляется: вы можете развернуть его самостоятельно, воспользоваться предложением одного из облачных провайдеров или воспользоваться локальным Minikube.

Объект Ingress описывается в нашем гайде в расчёте на [nginx-ingress](https://kubernetes.github.io/ingress-nginx/). Если вы используете другой контроллер — вам предстоит адаптировать конфигурацию самостоятельно.

## Домен

Мы предполагаем, что к началу прохождения гайда вы привязали к своёму кластеру какой-то домен.

{% offtopic title="Что это значит?" %}
Предполагается, что у вас есть домен, к которому вы привязываете DNS-сервер, позволяющий настраивать [ресурсные записи DNS](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BF%D1%8B_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BD%D1%8B%D1%85_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B5%D0%B9_DNS). Он может быть предоставлен вашим регистратором, предоставляющим домен, или облачной платформой, или, возможно, вы самостоятельно его установили и настраиваете (см. также [как работает DNS](https://firstwiki.ru/index.php/%D0%9A%D0%B0%D0%BA_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82_DNS)).
Это также означает, что у вашего кластера есть IP-адреса, по которым он доступен.

Требуется прописать правильные A-записи в DNS-сервере, чтобы нужные домены были направлены на кластер.
{% endofftopic %}

В гайде мы будем использовать следующие домены:

- example.com — направлен на кластер;
- *.example.com — направлены на кластер;
- registry.example.com — для GitLab Registry;
- gitlab.example.com — для GitLab.

## Требования к GitLab

Предполагается, что в GitLab будет включён GitLab CI и Registry.
Для прохождения гайда не обязательна собственная установка GitLab — достаточно ограничиться заведением учётной записи на [gitlab.com](https://about.gitlab.com/).

## Требования к GitLab Runner

{% offtopic title="Что такое Runner?" %}
Под термином «раннер» зачастую подразумевают три вещи:

- CLI-утилиту, которая устанавливается куда-то в кластере и осуществляет запуск сценария сборки и деплоя;
- Настройки, которые делаются в GitLab CI в связи с установкой CLI-утилиты на какой-то из серверов;
- Выделенный сервер (если такой есть), на котором запускается CLI-утилита.
{% endofftopic %}

Есть несколько вариантов установки и настройки раннера: он может быть установлен на отдельном сервере, на нескольких серверах или запускаться на динамически создаваемых узлах. В гайде будет рассматриваться самый простой сценарий: использование одного узла.

{% offtopic title="Как быть с более сложными конфигурациями раннеров?" %}
В werf поддерживается [распределённый режим сборки]({{ site.docsurl }}/documentation/guides/switch_to_distributed_mode.html).
При необходимости есть возможность сделать образ с werf и запускать его внутри Docker. Готовый Docker-образ со всем необходимым находится в разработке.

Также в разработке [находится](https://github.com/werf/werf/issues/2200) механика параллельной сборки.
{% endofftopic %}

Требования таковы:

* У раннера есть сетевая доступность до Kubernetes и до Registry;
* Для пользователя, которого использует GitLab Runner, [установлен multiwerf]({{ site.docsurl }}/documentation/guides/installation.html#installing-multiwerf);
* Для пользователя, которого использует GitLab Runner, установлен kubectl и добавлен конфигурационный файл для подключения к Kubernetes.
* GitLab Runner подключен к GitLab с тегом `werf`.

## Требования к приложению

В гайде используется приложение, которое уже соответствует необходимым требованиям (см. ниже). Однако, когда вы будете реализовывать собственные приложения, возможно, потребуется немного их дорабатывать.

{% offtopic title="Что за требования?" %}

Наилучшим образом приложения будут работать в Kubernetes, если они соответствуют [методологии 12 факторов](https://12factor.net/ru/). В таком случае в Kubernetes работают stateless-приложения, которые не зависят от среды. Это важно, так как кластер может самостоятельно переносить приложения с одного узла на другой, заниматься масштабированием и т.п. — и мы не указываем, где конкретно запускать приложение, а лишь формируем правила, на основании которых кластер принимает свои решения.

Если приложение не соответствует этим требованиям полностью или частично, можно найти обходные пути, однако это непростая задача, рассмотрение которой уходит за рамки данного гайда.

{% endofftopic %}

<div id="go-forth-button">
    <go-forth url="020_basic.html" label="Базовые настройки" base-url="applications_guide_ru"></go-forth>
</div>
