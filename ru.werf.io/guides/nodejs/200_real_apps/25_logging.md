---
title: Логгирование
permalink: nodejs/200_real_apps/25_logging.html
layout: "wip"
---

{% filesused title="Файлы, упомянутые в главе" %}
- app.js
{% endfilesused %}

Логгирование — важная часть разработки, позволяющая понять что происходит с приложением. В этой главе мы рассмотрим, как правильно писать логи для приложения в Kubernetes, в каких случаях вам могут понадобиться логи и как туда смотреть.

## Организация логгирования

Некоторые приложения сконфигурированы так, чтобы писать логи в файл. Это некорректно для приложений, запускаемых в kubernetes: docker-образ в такой ситуации будет бесконтрольно разрастаться, а при перевыкате приложения — логи исчезнут. 

Правильный путь — отправлять логи в [stdout и stderr](https://habr.com/ru/post/55136/). Kubernetes собирает такие логи и есть различные решения, позволяющие централизованно с ними работать.

Для Node.JS способ правильно отправлять логи — это функции `console.log()` и `console.error()`, к примеру:

```js
// Connection to SQLite
global_errors = [];
let sqlite_file = process.env.SQLITE_FILE;
if (! sqlite_file) {
  console.log('Environment variable SQLITE_FILE is not set! I will use in-memory database.');
  sqlite_file = ':memory:';
}
```

## Использование логов

Важно, что в случае критических ошибок приложение должно не только писать логи, но и прекращать работу с кодом ошибки, отличным от нуля. Тогда оркестратор сможет понять, что что-то идёт не так и другим механизмам (например, werf) будет проще обратить ваше внимание на это.

То есть неправильно писать так:

```js
if (critical_error) {
  console.error("Критическая ошибка в подключении к S3 хранилищу");
}
```

Скорее правильно делать так:

```js
if (critical_error) {
  console.error("Критическая ошибка в подключении к S3 хранилищу");
  process.exit(1);
}
```

Так как в реальности приложения не всегда так делают — полезно заглядывать в логи не только в случае возникновения ошибок, но и просто после выката приложения в кластер.

## Как смотреть логи

За отправляемыми логами можно следить через `kubectl`, например:

```shell
kubectl -n werf-guided-nodejs logs <имя Pod-а> -f
```

<div id="go-forth-button">
    <go-forth url="30_assets.html" label="Генерируем и раздаём ассеты" framework="{{ page.label_framework }}" ci="{{ page.label_ci }}" guide-code="{{ page.guide_code }}" base-url="{{ site.baseurl }}"></go-forth>
</div>
