## Требования !!!

- GitLab;

- {{include.host}}ост для запуска GitLab Runner'а с предустановленными:

  * Bash;

  * Git версии 2.18.0 или новее;

  * GPG;
  {% if include.docker == true %}
  * [Docker Engine](https://docs.docker.com/engine/install/);
  {% endif %}

- [Argo CD](https://argo-cd.readthedocs.io/en/stable/getting_started/#1-install-argo-cd).

## Установка GitLab Runner

Установите GitLab Runner на выделенный для него хост, следуя [официальным инструкциям](https://docs.gitlab.com/runner/install/linux-repository.html).

{% if include.buildah == true %}
{% include configurator/partials/dev/buildah_install.md.liquid %}
{% endif %}

## Установка werf

Чтобы установить werf на хост GitLab Runner'а, выполните следующую команду:

```
curl -sSL https://werf.io/install.sh | bash -s -- --ci
```

## Регистрация GitLab Runner

Следуйте [официальным инструкциям](https://docs.gitlab.com/runner/register/index.html) по регистрации GitLab Runner'а в GitLab'е; укажите Shell в качестве исполнителя. После завершения регистрации может потребоваться [дополнительная настройка GitLab Runner'а](https://docs.gitlab.com/runner/configuration/advanced-configuration.html).

## Настройка container registry

[Включите сборку мусора](https://docs.gitlab.com/ee/administration/packages/container_registry.html#container-registry-garbage-collection) в своем container registry.

## Подготовка системы для кроссплатформенной сборки (опционально)

> Этот шаг необходим только если собираются образы для платформ, отличных от хост-платформы, на которой запущен werf.

С помощью qemu-user-static зарегистрируйте эмуляторы в системе:

```shell
docker run --restart=always --name=qemu-user-static -d --privileged --entrypoint=/bin/sh multiarch/qemu-user-static -c "/register --reset -p yes && tail -f /dev/null"
```

## Установка Argo CD Image Updater

Установите Argo CD Image Updater с патчем ["continuous deployment of OCI Helm chart type application"](https://github.com/argoproj-labs/argocd-image-updater/pull/405):

```shell
kubectl apply -n argocd -f https://raw.githubusercontent.com/werf/3p-argocd-image-updater/master/manifests/install.yaml
```
